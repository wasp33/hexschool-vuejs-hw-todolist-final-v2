import{c as m,o as h,a as t,n as _,t as k,w as $,r as f,b as L,i as I,u as z,d as y,e as B,v as O,F as N,f as R,g as S}from"./index-TRLYh08T.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as u}from"./index-NIGUFBhG.js";const V="/hexschool-vuejs-hw-todolist-final-v2/assets/nolist-NGMfK5mZ.svg",D={class:"todo-item"},M={class:"todoList_label"},U=["checked"],j={__name:"TodoItem",props:{id:String,content:String,completed:{type:Boolean,default:!1}},emits:["emitFinishFromList","emitRemoveItem"],setup(n,{emit:p}){const a=p,s=()=>{console.log("finishFromList id:",n.id),a("emitFinishFromList",{id:n.id,content:n.content,completed:!n.completed})},d=()=>{console.log("removeTodo id:",n.id),a("emitRemoveItem",n.id)};return(l,g)=>(h(),m("div",D,[t("li",null,[t("label",M,[t("input",{class:"todoList_input",type:"checkbox",checked:n.completed,onChange:s},null,40,U),t("span",{class:_({"completed-text":n.completed})},k(n.content),3)]),t("span",{onClick:$(d,["stop"]),class:"remove-button"},"X")])]))}},H=w(j,[["__scopeId","data-v-a055ef35"]]),P={id:"todoListPage",class:"bg-half"},G={class:"todo_sm"},K={href:"#"},X={class:"conatiner todoListPage vhContainer"},Z={class:"todoList_Content"},q={class:"inputBox"},J={key:0,class:"todoList_list"},Q={class:"todoList_tab"},W={class:"todoList_items"},Y={class:"todoList_statistics"},ee={key:1},v="https://todolist-api.hexschool.io",te={__name:"HomeView",setup(n){const p=I("$swal"),a=z(),s=f([]),d=f({}),l=f();L(async()=>{if(l.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1"),!l.value){p("請先登入","To continue","info"),a.push("/login");return}console.log("Token:",l.value);try{const e=await u.get(`${v}/users/checkout`,{headers:{Authorization:l.value}});console.log("Token is valid",e),d.value=e.data,console.log("User data:",d.value),g()}catch(e){p("您未曾登入此網站","請登入系統",e),a.push("/login")}});const g=async()=>{try{const e=await u.get(`${v}/todos`,{headers:{Authorization:l.value}});console.log("User todos:",e),s.value=e.data.data}catch(e){alert("Error fetching todos:",e)}},x=()=>{try{const e=u.post(`${v}/users/sign_out`,{},{headers:{Authorization:document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}});console.log("signOut",e),p("已登出",`Bye~~ ${d.value.nickname}`,"success"),a.push("/login")}catch(e){alert("Error Sign Out: ",e),a.push("/login")}},c=f("all"),r=f("");function T(e){c.value=e}const C=()=>{if(alert(`Add todo: ${r.value}`),r.value.trim()===""){alert("請輸入待辦事項");return}u.post(`${v}/todos`,{content:r.value},{headers:{Authorization:l.value}}).then(e=>{console.log("Add todo response:",e),g()}).catch(e=>{alert("Error adding todo:",e)}),r.value=""},F=e=>{console.log("Finish from list id:",e.id),u.patch(`${v}/todos/${e.id}/toggle`,{status:!e.completed},{headers:{Authorization:l.value}}).then(o=>{console.log("Toggle todo response:",o),g()}).catch(o=>{alert("Error toggling todo:",o)})},b=e=>{console.log("Remove item with id:",e),u.delete(`${v}/todos/${e}`,{headers:{Authorization:l.value}}).then(o=>{console.log("Delete todo response:",o),g()}).catch(o=>{alert("Error deleting todo:",o)}),s.value=s.value.filter(o=>o.id!==e)},A=y(()=>c.value==="all"?s.value:c.value==="pending"?s.value.filter(e=>e.status===!1):c.value==="completed"?s.value.filter(e=>e.status===!0):s.value),E=y(()=>s.value.filter(e=>e.status===!0).length);return L(()=>{console.log("Component mounted!")}),(e,o)=>(h(),m("div",P,[t("nav",null,[o[4]||(o[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",G,[t("a",K,[t("span",null,k(d.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{onClick:x,href:"#login"},"登出")])])]),t("div",X,[t("div",Z,[t("div",q,[B(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=i=>r.value=i),placeholder:"請輸入待辦事項"},null,512),[[O,r.value]]),t("a",{href:"#",onClick:C},[...o[5]||(o[5]=[t("i",{class:"fa fa-plus"},"+",-1)])])]),t("p",null,"current input: "+k(r.value),1),s.value.length>0?(h(),m("div",J,[t("ul",Q,[t("li",null,[t("a",{href:"#",onClick:o[1]||(o[1]=$(i=>T("all"),["prevent"])),class:_({active:c.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:o[2]||(o[2]=$(i=>T("pending"),["prevent"])),class:_({active:c.value==="pending"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:o[3]||(o[3]=$(i=>T("completed"),["prevent"])),class:_({active:c.value==="completed"})},"已完成",2)])]),t("div",W,[(h(!0),m(N,null,R(A.value,i=>(h(),m("ul",{class:"todoList_item",key:i.id},[S(H,{id:i.id,content:i.content,completed:i.status,onEmitFinishFromList:F,onEmitRemoveItem:b},null,8,["id","content","completed"])]))),128)),t("div",Y,[t("p",null,k(s.value.length-E.value)+" 個待完成項目",1)])])])):(h(),m("div",ee,[...o[6]||(o[6]=[t("p",null,"目前尚無待辦事項",-1),t("img",{src:V,alt:""},null,-1)])]))])])]))}},le=w(te,[["__scopeId","data-v-d6cc572c"]]);export{le as default};
